<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>百家樂大路系統</title>
  <style>
    body {
      margin: 0;
      padding: 20px;
      font-family: "Noto Sans TC", sans-serif;
      background-color: #fff;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    h1 {
      margin-bottom: 10px;
    }

    #button-group {
      margin-bottom: 20px;
    }

    button {
      padding: 10px 20px;
      margin: 5px;
      font-size: 16px;
      border-radius: 6px;
      border: none;
      cursor: pointer;
    }

    #grid {
      display: grid;
      grid-template-columns: repeat(20, 30px);
      grid-template-rows: repeat(6, 30px);
      gap: 2px;
    }

    .cell {
      width: 30px;
      height: 30px;
      border: 1px solid #ccc;
      box-sizing: border-box;
      background-color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 50%;
    }

    .banker {
      background-color: red;
    }

    .player {
      background-color: blue;
    }
  </style>
</head>
<body>

  <h1>百家樂大路</h1>

  <div id="button-group">
    <button onclick="addResult('b')">莊</button>
    <button onclick="addResult('p')">閒</button>
    <button onclick="addResult('t')">和</button>
    <button onclick="undo()">清除</button>
    <button onclick="reset()">全部清除</button>
  </div>

  <div id="grid"></div>

  <script>
    const grid = document.getElementById('grid');
    const maxCols = 20;
    const maxRows = 6;
    const cells = [];
    const results = [];

    // 初始化格線
    for (let row = 0; row < maxRows; row++) {
      for (let col = 0; col < maxCols; col++) {
        const cell = document.createElement('div');
        cell.classList.add('cell');
        cell.dataset.row = row;
        cell.dataset.col = col;
        grid.appendChild(cell);
        cells.push(cell);
      }
    }

    function drawGrid() {
      // 清空畫面
      cells.forEach(cell => {
        cell.classList.remove('banker', 'player');
      });

      // 畫大路
      let col = 0;
      let row = 0;
      let currentColor = null;
      let fixedRow = null; // 擠位行
      let tempCol = col;

      for (let i = 0; i < results.length; i++) {
        const result = results[i];
        if (result === 't') continue; // 和不佔格

        if (i === 0) {
          // 第一顆
          currentColor = result;
          row = 0;
          col = 0;
        } else {
          if (result === currentColor) {
            // 同色：往下畫
            if (row < maxRows - 1 && !getCell(col, row + 1).classList.contains('banker') && !getCell(col, row + 1).classList.contains('player')) {
              row++;
            } else {
              // 向右擠位固定行
              if (fixedRow === null) fixedRow = row;
              col++;
              row = fixedRow;
            }
          } else {
            // 換色：往右一欄第1行（直落）
            col++;
            row = 0;
            currentColor = result;
            fixedRow = null;
          }
        }

        const cell = getCell(col, row);
        if (cell) {
          cell.classList.add(result === 'b' ? 'banker' : 'player');
        }
      }
    }

    function getCell(col, row) {
      if (col >= 0 && col < maxCols && row >= 0 && row < maxRows) {
        return cells[row * maxCols + col];
      }
      return null;
    }

    function addResult(result) {
      results.push(result);
      drawGrid();
    }

    function undo() {
      results.pop();
      drawGrid();
    }

    function reset() {
      results.length = 0;
      drawGrid();
    }
  </script>

</body>
</html>
